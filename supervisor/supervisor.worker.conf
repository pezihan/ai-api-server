[program:ai_server_worker]
# 关键：用bash -l（登录shell）启动，-i强制交互模式，确保加载所有终端环境
# 注：-l = --login（加载登录shell配置），-i = --interactive（交互模式）
command=/bin/bash -li -c "cd /home/ubuntu/ai-api-server && python start_worker.py"
directory=/home/ubuntu/ai-api-server  # 工作目录
autostart=true
autorestart=true
startretries=3
# 日志配置
stdout_logfile=/var/log/ai_server_worker.log
stderr_logfile=/var/log/ai_server_worker.log
redirect_stderr=true
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
# 必须指定用户（和你终端登录的用户一致，比如root）
user=root
# 禁用supervisor的环境清理（关键：保留登录shell加载的所有变量）
environment=
    HOME="/root",
    USER="root",
    CUDA_HOME="/usr/local/cuda",
    PATH="/usr/local/cuda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
    LD_LIBRARY_PATH="/usr/local/cuda/lib64:$LD_LIBRARY_PATH"
# 禁用环境清理（保留注入的变量）
nocleanup=true